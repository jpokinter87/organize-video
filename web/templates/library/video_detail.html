{% extends "base.html" %}

{% block title %}{{ video.title_fr|default:video.detected_title }} - Video Organizer{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Back link -->
    <a href="{% url 'library:index' %}" class="text-dark-400 hover:text-white mb-6 inline-flex items-center gap-1">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        Retour a la bibliotheque
    </a>

    <!-- Main content -->
    <div class="flex flex-col md:flex-row gap-8">
        <!-- Poster -->
        <div class="flex-shrink-0 w-full md:w-80">
            <div class="aspect-[2/3] rounded-lg overflow-hidden shadow-2xl">
                {% if video.poster_local %}
                <img src="{{ video.poster_local.url }}"
                     alt="{{ video.title_fr|default:video.detected_title }}"
                     class="w-full h-full object-cover">
                {% elif video.poster_path %}
                <img src="https://image.tmdb.org/t/p/w500{{ video.poster_path }}"
                     alt="{{ video.title_fr|default:video.detected_title }}"
                     class="w-full h-full object-cover">
                {% else %}
                <div class="w-full h-full bg-dark-800 flex items-center justify-center">
                    <svg class="w-24 h-24 text-dark-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"/>
                    </svg>
                </div>
                {% endif %}
            </div>

            <!-- Quick info -->
            <div class="mt-4 space-y-2">
                {% if video.vote_average %}
                <div class="flex items-center gap-2">
                    <svg class="w-5 h-5 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                    </svg>
                    <span class="text-white font-medium">{{ video.vote_average|floatformat:1 }}/10</span>
                </div>
                {% endif %}

                {% if video.detected_year %}
                <div class="flex items-center gap-2 text-dark-300">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    <span>{{ video.detected_year }}</span>
                </div>
                {% endif %}

                {% if video.genre %}
                <div class="flex items-center gap-2 text-dark-300">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                    </svg>
                    <span>{{ video.genre }}</span>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Details -->
        <div class="flex-1 min-w-0">
            <!-- Title -->
            <h1 class="text-4xl font-bold text-white">
                {{ video.title_fr|default:video.detected_title }}
            </h1>
            {% if video.title_original and video.title_original != video.title_fr %}
            <p class="text-xl text-dark-400 mt-1 italic">{{ video.title_original }}</p>
            {% endif %}

            <!-- Category & Genres badges -->
            <div class="mt-4 flex flex-wrap gap-2">
                <span class="px-3 py-1 bg-primary-500/20 text-primary-400 rounded-full text-sm">
                    {{ video.get_category_display }}
                </span>
                {% if video.genres_list %}
                {% for genre in video.genres_list %}
                <span class="px-3 py-1 bg-dark-700 text-dark-300 rounded-full text-sm">{{ genre }}</span>
                {% endfor %}
                {% endif %}
            </div>

            <!-- Directors -->
            {% if video.directors %}
            <div class="mt-6">
                <h3 class="text-sm font-medium text-dark-400 uppercase tracking-wider">Realisateur</h3>
                <p class="text-white mt-1">{{ video.directors|join:", " }}</p>
            </div>
            {% endif %}

            <!-- Cast -->
            {% if video.cast %}
            <div class="mt-4">
                <h3 class="text-sm font-medium text-dark-400 uppercase tracking-wider">Casting</h3>
                <p class="text-white mt-1">{{ video.cast|slice:":5"|join:", " }}</p>
            </div>
            {% endif %}

            <!-- Synopsis -->
            {% if video.overview %}
            <div class="mt-6">
                <h3 class="text-sm font-medium text-dark-400 uppercase tracking-wider">Synopsis</h3>
                <p class="text-dark-200 mt-2 leading-relaxed">{{ video.overview }}</p>
            </div>
            {% endif %}

            <!-- Technical info -->
            <div class="mt-8 p-4 bg-dark-800 rounded-lg border border-dark-700">
                <h3 class="text-sm font-medium text-dark-400 uppercase tracking-wider mb-4">Informations techniques</h3>
                <dl class="grid grid-cols-2 gap-4 text-sm">
                    {% if video.spec_string %}
                    <div>
                        <dt class="text-dark-400">Qualite</dt>
                        <dd class="text-white font-mono">{{ video.spec_string }}</dd>
                    </div>
                    {% endif %}
                    {% if video.resolution %}
                    <div>
                        <dt class="text-dark-400">Resolution</dt>
                        <dd class="text-white">{{ video.resolution }}</dd>
                    </div>
                    {% endif %}
                    {% if video.video_codec %}
                    <div>
                        <dt class="text-dark-400">Codec video</dt>
                        <dd class="text-white">{{ video.video_codec }}</dd>
                    </div>
                    {% endif %}
                    {% if video.language %}
                    <div>
                        <dt class="text-dark-400">Langue</dt>
                        <dd class="text-white">{{ video.language }}</dd>
                    </div>
                    {% endif %}
                    {% if video.file_size %}
                    <div>
                        <dt class="text-dark-400">Taille</dt>
                        <dd class="text-white">{{ video.file_size|filesizeformat }}</dd>
                    </div>
                    {% endif %}
                </dl>
            </div>

            <!-- File paths -->
            <div class="mt-6 p-4 bg-dark-800 rounded-lg border border-dark-700">
                <h3 class="text-sm font-medium text-dark-400 uppercase tracking-wider mb-4">Fichiers</h3>
                <dl class="space-y-3 text-sm">
                    <div>
                        <dt class="text-dark-400">Fichier original</dt>
                        <dd class="text-white font-mono text-xs break-all mt-1">{{ video.original_filename }}</dd>
                    </div>
                    {% if video.formatted_filename %}
                    <div>
                        <dt class="text-dark-400">Nom formate</dt>
                        <dd class="text-white font-mono text-xs break-all mt-1">{{ video.formatted_filename }}</dd>
                    </div>
                    {% endif %}
                    {% if video.destination_path %}
                    <div>
                        <dt class="text-dark-400">Destination</dt>
                        <dd class="text-white font-mono text-xs break-all mt-1">{{ video.destination_path }}</dd>
                    </div>
                    {% endif %}
                </dl>
            </div>
        </div>
    </div>

    <!-- Similar videos -->
    {% if similar_videos %}
    <div class="mt-12">
        <h2 class="text-xl font-bold text-white mb-6">Videos similaires</h2>
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
            {% for v in similar_videos %}
            {% include "components/poster_card.html" with video=v %}
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
